@model dynamic
@{
    string action = this.ViewContext.RouteData.Values["action"] != null ? this.ViewContext.RouteData.Values["action"].ToString() : null;

    string modelName = ViewData.TemplateInfo.GetFullHtmlFieldName(string.Empty);
}

<input type="hidden" asp-for="@Model" value="@Model" />
<input type="text" name="@(Url.Content(modelName))" id="txt@(Url.Content(modelName))" class="form-control" value="@Model" />
<small>
    <div id="video-error" class=" text-center text-capitalize"></div>
</small>

<script type="text/javascript">
    $(function () {
    var route = window.location.pathname.split("/");
   @* console.log(route[route.length -1].toLowerCase());   *@

    var splitRoute ="@action.ToLower()" === "edit"? route[route.length -2].toLowerCase():  route[route.length -1].toLowerCase();
      if(splitRoute === "vimeo"){

      $('#txt@(Url.Content(modelName))').blur(function () {
            var videoId = getVimeoId($('#txt@(Url.Content(modelName))').val());
            $('#@(Url.Content(modelName))').val(videoId);
            $('#VideoUrl').val($('#txt@(Url.Content(modelName))').val());
        });
    }else{
          $('#txt@(Url.Content(modelName))').blur(function () {

            var videoId = getYoutubeId($('#txt@(Url.Content(modelName))').val());
              @*alert($('#txt@(Url.Content(modelName))').val());*@
            $('#@(Url.Content(modelName))').val(videoId);
        });
    }
    });
      function getVimeoId(url) {
        if (url === null) { return ""; }

        var vimeo;
        var results;
    if (url.indexOf("https://vimeo.com/") >= 0)
        {
            results = url.split("/");
            vimeo = (results === null) ? url : results[results.length -1];
        }

       console.log(vimeo);
        return vimeo;
    }

    function getYoutubeId(url) {
        if (url === null) { return ""; }

        var vid;
        var s1; var s2;
        var results;

        if (url.indexOf("?v=") >= 0) {
            $('#video-error').html("");
            $('#video-error').removeClass("alert");
            $('#video-error').removeClass("alert-danger");
            results = url.match("[\\?&]v=([^&#]*)");
            vid = (results === null) ? url : results[1];
        }
        else if (url.toLowerCase().indexOf("youtu.be") >= 0) {
            $('#video-error').html("");
            $('#video-error').removeClass("alert");
            $('#video-error').removeClass("alert-danger");
            var video = url.split('/');
            results = video[video.length - 1];
            vid = results;
        }
        else {
            $('#video-error').html("Enter valid youtube Link");
            $('#video-error').addClass("alert");
            $('#video-error').addClass("alert-danger");
        }
        return vid;
    }
</script>

